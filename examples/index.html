<!doctype html>
<html lang="en" data-framework="purescript">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>

<body>
  <script>
    // Set up Blockfrost API key prompt and UI around it.
    // This code is only needed for CTL itself.
    const oldBlockfrostKey = localStorage.getItem("BLOCKFROST_API_KEY");

    const addSpacer = () => {
        const spacer = document.createElement("span");
        spacer.textContent = " ";
        document.body.appendChild(spacer);
    };

    const addHtml = html => {
        const div = document.createElement("div");
        div.innerHTML = html;
        document.body.appendChild(div);
    };

    addHtml(`<h3>Blockfrost setup</h3>`);

    if (oldBlockfrostKey !== null) {
        const keyIsSetEl = document.createElement("span");
        keyIsSetEl.innerHTML =
            '✅ <a target="_blank" href="https://blockfrost.io/">Blockfrost</a> key is set.';
        document.body.appendChild(keyIsSetEl);

        addSpacer();

        const setBFKeyButton = document.createElement("button");
        setBFKeyButton.textContent = "Unset";
        setBFKeyButton.onclick = () => {
            localStorage.removeItem("BLOCKFROST_API_KEY");
            window.location = "/";
        };
        document.body.appendChild(setBFKeyButton);
    } else {
        const keyIsNotSetEl = document.createElement("span");
        keyIsNotSetEl.innerHTML =
            '❌ <a target="_blank" href="https://blockfrost.io/">Blockfrost</a> key is not set.';
        document.body.appendChild(keyIsNotSetEl);

        addSpacer();

        const setBFKeyButton = document.createElement("button");
        setBFKeyButton.textContent = "Set Blockfrost API key";
        setBFKeyButton.onclick = () => {
            const key = prompt("Enter your Blockfrost API key");
            if (key !== null) {
                localStorage.setItem("BLOCKFROST_API_KEY", key);
                window.location = "/";
            }
        };
        document.body.appendChild(setBFKeyButton);
    }

    addHtml(`<br>If you are viewing this page via an E2E-test-suite-controlled browser, to set the Blockfrost API key permanently, close the browser and run:
      <pre>
        npm run e2e-pack-settings
      </pre>
      The key will be saved to your settings archive. Sharing the archive file after that implies that the key can be leaked.<br>`);
  </script>
  <script type="module">
    import("./bundle.js").then(m => m.main());
  </script>
  Examples source code is located in <i>examples/</i> directory.<br>
</body>
</html>
